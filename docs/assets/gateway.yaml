# -------------------------------------------------------------------------------------
#
# Copyright (c) 2026, WSO2 LLC. (http://www.wso2.com). All Rights Reserved.
#
# This software is the property of WSO2 LLC. and its suppliers, if any.
# Dissemination of any information or reproduction of any material contained 
# herein is strictly forbidden, unless permitted by WSO2 in accordance with the 
# WSO2 Commercial License available at https://wso2.com/licenses/eula/3.2
#
# --------------------------------------------------------------------------------------

# Example Gateway API Gateway resource for WSO2 API Manager
# This must be created before deploying the Helm chart when using Gateway API
# IMPORTANT: Update the certificate data in the Secret resource below with your own TLS certificate and key for production use.
#

apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: apim-gateway-tls
  namespace: apim
data:
  tls.crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURDekNDQWZPZ0F3SUJBZ0lVTTZQY3Vjd2ErWVEvS1cwTjcwbWtDUjY1UjVJd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0ZURVRNQkVHQTFVRUF3d0tLaTUzYzI4eUxtTnZiVEFlRncweU5qQXhNall4TURJNU5EVmFGdzB5TnpBeApNall4TURJNU5EVmFNQlV4RXpBUkJnTlZCQU1NQ2lvdWQzTnZNaTVqYjIwd2dnRWlNQTBHQ1NxR1NJYjNEUUVCCkFRVUFBNElCRHdBd2dnRUtBb0lCQVFEQ1hZOGd6SzIxdmhlb0puakhaTXRSR0twOTN3dUgvdzdPLy9OSGZuUHQKZVR6azFORk43R3lqTnZrbW5kZEppVHl4d3l1U0FFVWd3R1dsemhRaEtzV3QxNkVGMXFZYUg4VjhlNC9JWks2MApHMHQ3d1FWdGtrM0tHZUt0V3pZYXBEa0k2TWxvTUduY3laUFdOek9QNWgxYUhHNTZ6VFI0ZWZGRDBMM3JrT0oyCnlLTzFIeDB6NzZPSENlWklRNDd0eGl1ekdLVUtmRHEwcXZDWHBPUUFTSm5JNjR0M2VKYVJjNDFuVFZ4bjNLSFoKV09Bb25rZUFpbVNCOTdQN2xRQXZ1SnMvTFVra09PcDFHZWFFSGdLOElVUWJrRStVRVdMZ2pwbkJjN2lFSkYzUAp1ek05bVJweHJGV1c1NDdGc2J1YkJlRWs3bVlLazZuOUpQQWtFS0VCZTRiWEFnTUJBQUdqVXpCUk1CMEdBMVVkCkRnUVdCQlJOTGIzRzU1YUNiTys0N2MwOG9ub3hDMXFWNVRBZkJnTlZIU01FR0RBV2dCUk5MYjNHNTVhQ2JPKzQKN2MwOG9ub3hDMXFWNVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCSwowV3h2ZXJhUFZGQzNqaW5obG50cTlzUGN5anZPL1dXZlNGUUcveHhGUEM1aHE0OVhndmUxcWlsT2hrRmhFNm5CCjRIRVNBbzlMR2xlbEFETmF3d0tFTGVBR0dBWU9qUGxoaG95N0F1dGF0MXIvMG5vZzRHTjRVMW1vUEZiNDNZeUUKWFdKcTZ0ZVl2UmFWRFFDeFFPTlhxNDh0ZFYwcWRQclBlZ0FsRU9mTXdHQ0ZlV2xDQ2dvOE1MWXp1YVZDR1RyZwpMQ3NIQWJHVUNjVkpqVUNyd0NZRjVNNFdycEpQV1QyMGpTTlZ3Qk81Nng1VHJsMXNkUnlzMHZzWjFvYjJnNENSCkwydFdSOE1CdW5INHpQYy9jcEc3Y2ZBY25BTFM0dUc5Z2NaN3kxT2taK0FJcjNDcVpqaDZLZDhZYVJoNmhrSWYKVUdrN1FhN0tONzJES0g3T29wcWcKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
  tls.key: "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRENYWThneksyMXZoZW8KSm5qSFpNdFJHS3A5M3d1SC93N08vL05IZm5QdGVUemsxTkZON0d5ak52a21uZGRKaVR5eHd5dVNBRVVnd0dXbAp6aFFoS3NXdDE2RUYxcVlhSDhWOGU0L0laSzYwRzB0N3dRVnRrazNLR2VLdFd6WWFwRGtJNk1sb01HbmN5WlBXCk56T1A1aDFhSEc1NnpUUjRlZkZEMEwzcmtPSjJ5S08xSHgwejc2T0hDZVpJUTQ3dHhpdXpHS1VLZkRxMHF2Q1gKcE9RQVNKbkk2NHQzZUphUmM0MW5UVnhuM0tIWldPQW9ua2VBaW1TQjk3UDdsUUF2dUpzL0xVa2tPT3AxR2VhRQpIZ0s4SVVRYmtFK1VFV0xnanBuQmM3aUVKRjNQdXpNOW1ScHhyRldXNTQ3RnNidWJCZUVrN21ZS2s2bjlKUEFrCkVLRUJlNGJYQWdNQkFBRUNnZ0VBUUlEWExxM3Vta21QUlUwYk9TVVF1b1dpa3lwU0E5eVlHQWRtUDl4Tjhjb1IKOU9sUjJ2Znk1OG1uTHZNa0R2SCtGQXB1NjhHdUwxdmFnQWVmczVBajBYa2xwYS9pS1BwUlNtb2hRZ0p6M2k3Twp3cS9Bc3VmaWJBZGlMR0VBV0NBWEU0ZFp5L3VCTG5ZeFcxNnZmSHFFVkRMcVVWUEhyWkhlaVVCOXZ1OHkwUE5hCkY3Q09PNkc4Z0dRQ3Y4Z2xUMlF4THExQkZmSjRzNVRyZzBLamd6cHpKWFhFTkNTNVhDMlJhTXRGZit2b2RPSmMKMVk5ZWorR0pSdWpiNm9LQVYxd1VQeTdoVjJvU1ZjVmxRUnRsdTlFWHBGcUtjVmhVTlFBUDlsR1Bkem12WmFOSAp6QTcyM3BBZHo1NVdKeCtYS2ZnelZvSmFGMXFEMVFHN0o0Ky9jTzhpMVFLQmdRRGpWQXRNakdrelRTRmU2SDkxCmVtQUJIWUNOYUdPY0JidHhOR2prUFZBZG5VMWl6SWhNR1Z2eUk2K1JzT3dQNUVyOU54NHZVY3ZhN2xRMzNwQ2cKd1A2MzNOLzZSOHV4eEpDc1cxdWJ1ZkVuSHIxOHlON1dKcXZ4NnJPSWt1a0dyQStwaXNjc1dsS1lPNzhnZ3BrbAp2UEFuZUp4VnhrSFQyM0wrV1Bvc2pYeGJ2UUtCZ1FEYTRUYkdKYW13YWgwaEJ2S3ErVGR4WkFHWDAvWHl6TDRiCm95dFl2Y3hKNlhJYk5CYUlaL0d2NnJsclhFWUdTdFBCZ1MzWGNVbDVJbFhVN2FkdUFBREhyZWJVTXNsNENpY3QKK0pCU1BqbVBPRVlLVEYvT1pTV3V1ZGVuY1pTSGIzQ1pNN2JtYzdCN3Bxbkl0ODFzRi8ycHVraXM3Q0o3WkxvSQo1U2VGbkxpc0l3S0JnUUNuQVEwejlVc3J4eFFtOTBMNytTVWliSndPUm93M0NQY0ZXVzFkajdXVnJBUTMrdTUrCmlYckV6bmFpMzRqc3U5aGpZZVNvK3J4NlgvQTdBeVRaRkMrTXY1VkQ5dzZyMEM1QWtQVWgyRjVUVVAvLzlrbk8KcGFaWUdRWS81VDJRQzBPT1dFZXVTOFMxMWQ2NWNYZzFBektpckxhZFJRTURNd3F0MUl3bHd1T0RPUUtCZ1FDRApSOG1lbDBCciszbDFNY0dqSXM5S1IzMWRIMWpKUkZ4U0gxQUViZkoxOG5ycUxoZkZ3UEtKWFBQUm5RcXpBM1oyCi9aQU5SSG1aR2lyNUI0SUF6Q2VybkhaeWwvT1crQi8veHJKcFljRU1VZWhRalBaNXlOa05MNUpWY0I1eURUa3YKNm9DdFFINTk2N3l5RXV3M0JUeXo3SE5pcEU4YVM1UDVlZGgybjBWMG1RS0JnR2M4UUllMWh5WXFSaTFQaVBKQgpZcjUrY3ZXVFBOVWNqZC9QKzJiT082dVA2T2duUFI2djFVM3JyVkJna3VVQ2RON3p5bXhRb0Mva1Jrck11QVNCCmpJMTYzRm9QaGVnMXhldTdWQ1RhKzBFREN5TE5qZ2Vlb3d1aXJtR1k0WDVIbmJZekR2ZDNHMHdjLzhMRXV2WE0KY0gybzhFY1BJd1REQUdPNXdOOWdEdmJYCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K"

---

apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: wso2-apim-gateway
  namespace: apim
  # Optional annotations for gateway controller configuration
  annotations:
    nginx.org/lb-method: "ip_hash"  # For NGINX Gateway Fabric
spec:
  # Change gatewayClassName to match your installed Gateway API controller
  # Examples: nginx, istio, envoy-gateway, contour, gke-l7-global-external-managed
  gatewayClassName: nginx
  
  listeners:
  # Listener for API Manager Management interfaces (Publisher, DevPortal, Admin, Carbon)
  - name: management-https
    hostname: "am.wso2.com"
    port: 443
    protocol: HTTPS
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        name: apim-gateway-tls
    allowedRoutes:
      namespaces:
        from: Same
  
  # Listener for Gateway runtime traffic (API invocations)
  - name: gateway-https
    hostname: "gw.wso2.com"
    port: 443
    protocol: HTTPS
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        name: apim-gateway-tls
    allowedRoutes:
      namespaces:
        from: Same
  
  # Listener for WebSocket APIs
  - name: websocket-https
    hostname: "websocket.wso2.com"
    port: 443
    protocol: HTTPS
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        name: apim-gateway-tls
    allowedRoutes:
      namespaces:
        from: Same
  
  # Listener for WebSub APIs
  - name: websub-https
    hostname: "websub.wso2.com"
    port: 443
    protocol: HTTPS
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        name: apim-gateway-tls
    allowedRoutes:
      namespaces:
        from: Same
  
  # For distributed deployments, additional listeners for key-manager:
  
  # Listener for Key Manager
  - name: keymanager-https
    hostname: "km.wso2.com"
    port: 443
    protocol: HTTPS
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        name: apim-gateway-tls
    allowedRoutes:
      namespaces:
        from: Same
